<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Shajra</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; background: #f0f8ff; text-align: center; }
        
        /* HEADER STYLE */
        header {
            background-color: #2c3e50; 
            color: white; 
            padding: 15px 10px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-bottom: 2px solid #d4af37;
        }
        .site-title { 
            font-size: 24px; font-weight: bold; margin: 0;
            color: #ffd700; font-family: 'Georgia', serif; 
            text-shadow: 2px 2px 4px #000000; letter-spacing: 1px;
        }

        /* --- MENU BAR STYLE (NEW) --- */
        .menu-container {
            background: #34495e; /* Thoda light blue */
            overflow-x: auto; /* Side scrolling on mobile */
            white-space: nowrap;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            -webkit-overflow-scrolling: touch; /* Smooth scroll */
        }
        /* Scrollbar chupane ke liye */
        .menu-container::-webkit-scrollbar { display: none; }

        .menu-btn {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            text-decoration: none;
            margin: 0 5px;
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #d4af37; /* Gold Border */
            min-width: 60px;
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: #ffd700; /* Gold Background on Hover */
            color: #2c3e50; /* Blue Text */
            transform: translateY(-3px); /* Thoda upar uthega */
        }

        .menu-btn i {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .menu-text {
            font-family: 'Courier New', monospace; /* Stylish Font */
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        /* -------------------------- */

        .container { background: white; max-width: 400px; margin: 20px auto; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        .upload-btn { background: #3ecf8e; color: white; border: none; padding: 12px 25px; cursor: pointer; border-radius: 5px; font-weight: bold; margin-top: 10px; width: 100%; font-size: 16px; }
        .upload-btn:disabled { background: #ccc; }
        img { max-width: 100%; margin-top: 15px; border-radius: 8px; display: none; border: 2px solid #ddd; }
        #status { margin-top: 10px; color: #555; font-size: 14px; font-weight: bold; }
        #savedName { color: #2c3e50; text-transform: uppercase; margin-bottom: 5px; }

    </style>
</head>
<body>

    <header>
        <div class="site-title" id="mainTitle">Loading...</div>
        </header>

    <div class="menu-container">
        <a href="index.html" class="menu-btn">
            <i class="fa-solid fa-house"></i>
            <span class="menu-text">Home</span>
        </a>
        
        <a href="#" class="menu-btn">
            <i class="fa-solid fa-sitemap"></i>
            <span class="menu-text">Shajra</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-scroll"></i>
            <span class="menu-text">History</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-magnifying-glass"></i>
            <span class="menu-text">Search</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-images"></i>
            <span class="menu-text">Gallery</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-users"></i>
            <span class="menu-text">Members</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-map-location-dot"></i>
            <span class="menu-text">Map</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-calendar-days"></i>
            <span class="menu-text">Events</span>
        </a>

        <a href="#" class="menu-btn">
            <i class="fa-solid fa-phone"></i>
            <span class="menu-text">Contact</span>
        </a>

        <a href="admin.html" class="menu-btn" style="border-color: #e74c3c;">
            <i class="fa-solid fa-lock" style="color: #e74c3c;"></i>
            <span class="menu-text" style="color: #e74c3c;">Admin</span>
        </a>
    </div>

    <div class="container">
        <h3>Naya Member Add Karein</h3>
        <input type="text" id="nameInput" placeholder="Naam likhein...">
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="uploadData()" id="btn" class="upload-btn">Upload & Save</button>
        <p id="status"></p>
        <hr>
        <div id="displayArea">
            <h2 id="savedName">Loading...</h2>
            <img id="savedImage" src="" alt="Saved Image">
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://ojphjodmpyblyfyinacb.supabase.co';
        const k1 = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9qcGhqb2RtcHlibHlmeWluYWN";
        const k2 = "iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MTUwNTAsImV4cCI6MjA3OTk5MTA1MH0";
        const k3 = ".mwKu_g5_OT_89KcAeeSsY8IMlnakV2nQVtKRhWWTcDw";
        const supabaseKey = k1 + k2 + k3;

        const _supabase = supabase.createClient(supabaseUrl, supabaseKey, { auth: { persistSession: false } });

        async function loadSiteName() {
            const { data } = await _supabase.from('site_config').select('site_name').limit(1);
            if (data && data.length > 0) {
                document.getElementById('mainTitle').innerText = data[0].site_name;
            } else {
                document.getElementById('mainTitle').innerText = "Family Shajra";
            }
        }

        window.uploadData = async function() {
            const name = document.getElementById('nameInput').value;
            const file = document.getElementById('imageInput').files[0];
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');

            if (!name || !file) { alert("Naam aur Image zaroori hai!"); return; }

            btn.disabled = true;
            status.innerText = "Uploading...";

            try {
                const fileName = Date.now() + "_" + file.name.replace(/\s/g, '');
                const { error: imgError } = await _supabase.storage.from('family-images').upload(fileName, file);
                if (imgError) throw imgError;
                const { data: urlData } = _supabase.storage.from('family-images').getPublicUrl(fileName);
                
                status.innerText = "Saving...";
                const { error: dbError } = await _supabase.from('family_data').insert([{ full_name: name, image_url: urlData.publicUrl }]);
                if (dbError) throw dbError;

                alert("Saved!");
                location.reload();
            } catch (err) { alert(err.message); } finally { btn.disabled = false; }
        }

        async function loadLastEntry() {
            const { data } = await _supabase.from('family_data').select('*').order('id', { ascending: false }).limit(1);
            if (data && data[0]) {
                document.getElementById('savedName').innerText = data[0].full_name;
                const img = document.getElementById('savedImage');
                img.src = data[0].image_url;
                img.style.display = 'block';
            }
        }
        
        loadSiteName();
        loadLastEntry();
    </script>
</body>
</html>