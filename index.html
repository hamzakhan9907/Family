<!DOCTYPE html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Shajra</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 0; background: #f0f8ff; text-align: center; }
        
        header {
            background-color: #2c3e50; /* Dark Blue Background */
            color: white; 
            padding: 15px 20px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-bottom: 3px solid #d4af37; /* Gold Line neeche */
        }

        /* --- NAYA STYLE YAHAN HAI --- */
        .site-title { 
            font-size: 26px; /* Size bada kiya */
            font-weight: bold; 
            margin: 0;
            color: #ffd700; /* Gold Color (Sunehri) */
            font-family: 'Georgia', serif; /* Stylish Font */
            text-shadow: 2px 2px 4px #000000; /* Kaali Parchaai (Shadow) */
            letter-spacing: 1px; /* Haroof khulay khulay */
        }
        /* --------------------------- */

        .admin-btn { background-color: #e74c3c; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: bold; }
        
        .container { background: white; max-width: 400px; margin: 30px auto; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { width: 90%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; font-size: 16px; }
        
        .upload-btn { background: #3ecf8e; color: white; border: none; padding: 12px 25px; cursor: pointer; border-radius: 5px; font-weight: bold; margin-top: 10px; width: 100%; font-size: 16px; }
        .upload-btn:disabled { background: #ccc; }
        
        img { max-width: 100%; margin-top: 15px; border-radius: 8px; display: none; border: 2px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        #status { margin-top: 10px; color: #555; font-size: 14px; font-weight: bold; }
        
        /* Loading Text Style */
        #savedName { color: #2c3e50; text-transform: uppercase; margin-bottom: 5px; }
    </style>
</head>
<body>

    <header>
        <div class="site-title">Family Shajra</div>
        <button class="admin-btn" onclick="alert('Admin Panel jald aa raha hai')">Admin</button>
    </header>

    <div class="container">
        <h3>Naya Member Add Karein</h3>
        <input type="text" id="nameInput" placeholder="Naam likhein...">
        <input type="file" id="imageInput" accept="image/*">
        <button onclick="uploadData()" id="btn" class="upload-btn">Upload & Save</button>
        <p id="status"></p>
        <hr>
        <div id="displayArea">
            <h2 id="savedName">Loading...</h2>
            <img id="savedImage" src="" alt="Saved Image">
        </div>
    </div>

    <script>
        const supabaseUrl = 'https://ojphjodmpyblyfyinacb.supabase.co';
        
        // Key parts (Wahi purani key jo aapne bheji thi)
        const k1 = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9qcGhqb2RtcHlibHlmeWluYWN";
        const k2 = "iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0MTUwNTAsImV4cCI6MjA3OTk5MTA1MH0";
        const k3 = ".mwKu_g5_OT_89KcAeeSsY8IMlnakV2nQVtKRhWWTcDw";
        
        const supabaseKey = k1 + k2 + k3;

        const _supabase = supabase.createClient(supabaseUrl, supabaseKey, {
            auth: { persistSession: false }
        });

        window.uploadData = async function() {
            const name = document.getElementById('nameInput').value;
            const fileInput = document.getElementById('imageInput');
            const file = fileInput.files[0];
            const status = document.getElementById('status');
            const btn = document.getElementById('btn');

            if (!name || !file) { alert("Naam aur Image dono zaroori hain!"); return; }

            btn.disabled = true;
            status.innerText = "Uploading...";

            try {
                const fileName = Date.now() + "_" + file.name.replace(/\s/g, '');
                
                const { error: imgError } = await _supabase.storage.from('family-images').upload(fileName, file);
                if (imgError) throw imgError;

                const { data: urlData } = _supabase.storage.from('family-images').getPublicUrl(fileName);
                
                status.innerText = "Saving Data...";
                const { error: dbError } = await _supabase.from('family_data').insert([{ full_name: name, image_url: urlData.publicUrl }]);
                if (dbError) throw dbError;

                alert("Data Save Ho Gaya!");
                document.getElementById('nameInput').value = "";
                fileInput.value = "";
                loadLastEntry();

            } catch (err) {
                console.error(err);
                status.innerText = "Error: " + err.message;
                alert("Error: " + err.message);
            } finally {
                btn.disabled = false;
            }
        }

        async function loadLastEntry() {
            try {
                const { data } = await _supabase.from('family_data').select('*').order('id', { ascending: false }).limit(1);
                if (data && data.length > 0) {
                    document.getElementById('savedName').innerText = data[0].full_name;
                    const img = document.getElementById('savedImage');
                    img.src = data[0].image_url;
                    img.style.display = 'block';
                }
            } catch (e) { console.log(e); }
        }
        
        loadLastEntry();
    </script>
</body>
</html>